<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdminPage</title>
    <link rel="stylesheet" href="globalstyle.css">
    <link rel="stylesheet" href="adminstyle.css">
    <script src="globalScript.js"></script>
</head>
<body>
    <button class="homebutton" onclick="gotoHomePage()">Home</button>
    <br><br><br><br><br>
    <h1 class="tc">Admin Page</h1>
    <div class="button-set center">
        <button onclick="openPopUp('useradd-pop')">Add User</button>
        <button onclick="openPopUp('projectadd-pop');displayUsersInProjectAdd()">Add Project</button>
        <button onclick="openPopUp('usermanage-pop')">User Management</button>
    </div>
    <div id="useradd-pop" class="popup-page hide">
         <button class="xbutton" onclick="closePopUp('useradd-pop')">X</button>
         <h1 class="tc">Add User</h1>
         <div class="input-box">
             이름<input type="text" class="input-text" id="name-input" placeholder="이름을 입력하세요." style="width: 50%">
             <br>
             ID<input type="text" class="input-text" id="id-input" placeholder="ID를 입력하세요." style="width: 50%">
             <br>
             Password<input type="password" class="input-text" id="password-input" placeholder="Password를 입력하세요." style="width: 50%">
             <br>
             Level<select name="level" id="level-input">
                 <option value="PL">PL</option>
				 <option value="Developer">Developer</option>
                 <option value="Tester">Tester</option>
             </select>
         </div>
         <button class="popup-addbutton" onclick="addUser()">Add</button>
    </div>


    <div id="projectadd-pop" class="popup-page hide">
         <button class="xbutton" onclick="closePopUp('projectadd-pop')">X</button>
         <h1 class="tc">Project Add</h1>
         <div class="input-box">
             제목<input type="text" class="text-input" id="title-input" placeholder="제목을 입력하세요." style="width: 50%">
             <br>
             내용<textarea id="description-input" rows="10" cols="40" style="resize: none"></textarea>
         </div>
         <br><br>
         <div class="select-container center">
              <p>
                  <span class="select-head PL-head">PL</span>
                  <span class="select-head Dev-head">Dev</span>
                  <span class="select-head Tester-head">Tester</span>
              </p>
                <select id="PL-select">
                    <!---PL들 들어갈 자리--->
                </select>
                <select id="developer-select">
                    <!---Developer들 들어갈 자리--->
                </select>
                <select id="tester-select">
                    <!---Tester들 들어갈 자리--->
                </select>
        </div>
         <button class="popup-addbutton" onclick="addProject()">Add</button>
    </div>


    <div id="usermanage-pop" class="popup-page hide">
         <button class="xbutton" onclick="closePopUp('usermanage-pop')">X</button>
         <h1 class="tc">User Manage</h1>
         <select id="project-list" class="projectlist"> <!---get으로 모든 프로젝트 받아와서 여기에서 보여줘야함--->
             <option>project1</option>
             <option>project2</option>
             <option>project3</option>
         </select>
        <div class="user-table center">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Level</th>
                        <th>Check</th>
                    </tr>
                </thead>
                <tbody id="user-table-body"> <!---여기서 모든 user를 get으로 받아와서 보여줘야함--->
                    <tr>
                        <td>Sihun</td>
                        <td>Developer</td>
                        <td><input type="checkbox"></td>
                    </tr>
                <!-- User info will be appended here -->
                </tbody>
            </table>
        </div>
        <button class="confirmbutton">Confirm</button>
    </div>

    <div id="bg-page" class="hide"></div>

    <script>
		  function addUser() {
              const fullName = document.getElementById('name-input').value;
              const name = document.getElementById('id-input').value;
              const password = document.getElementById('password-input').value;
              const level = document.getElementById('level-input').value;

              if (fullName === "" || name === "" || password === "") {
                  alert("내용을 모두 기입 후 다시 시도해주세요.");
                  return;
              }

              fetch('http://localhost:8080/addUser', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({fullName, name, password, level})
              })
                  .then(response => response.text())
                  .then(data => {
                      if (data === 'true') {
                          alert("유저 추가 완료");
                          gotoAdminPage();
                      } else if (data === 'false') {
                          alert("중복된 아이디입니다.");
                      }
                  });
          }

          function displayUsersInProjectAdd() {
              fetch('http://localhost:8080/listUser')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                })
                  .then(data => {
                      if (Array.isArray(data)) {
                          data.forEach(user => {// id name fullName password level
                              switch(user.level) {
                                  case 1://PL
                                      addOption('PL-select', user.name);
                                      break;
                                  case 2://Developer
                                      addOption('developer-select', user.name);
                                      break;
                                  case 3://Tester
                                      addOption('tester-select', user.name);
                                      break;
                                  default:
                                      console.log("undefined level detected");
                              }
                          });
                      } else {
                          console.error('Expected an array but received:', data);
                      }
                  })
                  .catch(error => {
                      console.error('There was a problem with the fetch operation:', error);
                  });
          }
          function displayUsersInUserManage() {
              fetch('http://localhost:8080/listUser')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                })
                  .then(data => {
                      if (Array.isArray(data)) {
                          data.forEach(user => {// id name fullName password level
                              switch(user.level) {
                                  case 1://PL
                                      break;
                                  case 2://Developer

                                      break;
                                  case 3://Tester

                                      break;
                                  default:
                                      console.log("undefined level detected");
                              }
                          });
                      } else {
                          console.error('Expected an array but received:', data);
                      }
                  })
                  .catch(error => {
                      console.error('There was a problem with the fetch operation:', error);
                  });
          }

          function addTable(parentId, userId, userLevel) {

          }

		  function addProject() {
  			  const title = document.getElementById('title-input').value;
  	          const description = document.getElementById('description-input').value;
              const pl = document.getElementById('PL-select').value;
              const developer = document.getElementById('developer-select').value;
              const tester = document.getElementById('tester-select').value;
              if(title === "" || description === "내용을 입력하세요.") {
                    alert("제목이 비었거나 내용을 적지 않았습니다. 모두 기입 후 시도해주세요.");
                    return;
              }

  	          fetch('http://localhost:8080/addProject', {
  	              method: 'POST',
  	              headers: {
  	                  'Content-Type': 'application/json'
  	              },
  	              body: JSON.stringify({title, description, pl, developer, tester})
  	          })
  	              .then(response => response.text())
  	              .then(data => {
  	                  if (data === 'true') {
                          alert("프로젝트 추가 완료");
  	                      gotoAdminPage();
  	                  } else if (data === 'false') {
  	                      alert("중복된 프로젝트입니다.");
  	                  }
  	              });
  	      }
    </script>
</body>
</html>